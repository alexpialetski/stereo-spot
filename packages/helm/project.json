{
  "name": "helm",
  "$schema": "../../node_modules/nx/schemas/project-schema.json",
  "projectType": "application",
  "sourceRoot": "packages/helm",
  "implicitDependencies": ["aws-infra"],
  "targets": {
    "check": {
      "executor": "nx:run-commands",
      "options": {
        "cwd": "packages/helm",
        "command": "[ -f values-from-terraform.yaml ] || { echo 'Error: values-from-terraform.yaml not found. Run: nx run aws-infra:terraform-apply'; exit 1; }"
      },
      "cache": true,
      "inputs": ["default", "{projectRoot}/values-from-terraform.yaml"],
      "outputs": []
    },
    "lint": {
      "executor": "nx:run-commands",
      "options": {
        "cwd": "packages/helm",
        "command": "helm lint ."
      },
      "cache": true,
      "inputs": ["default"],
      "outputs": []
    },
    "template": {
      "executor": "nx:run-commands",
      "dependsOn": ["check"],
      "options": {
        "cwd": "packages/helm",
        "command": "helm template stereo-spot . -f values.yaml -f values-from-terraform.yaml > rendered-manifests.yaml"
      },
      "cache": true,
      "inputs": ["default", "{workspaceRoot}/packages/aws-infra/**/*.tf"],
      "outputs": ["{projectRoot}/rendered-manifests.yaml"]
    },
    "validate": {
      "executor": "nx:run-commands",
      "dependsOn": ["check"],
      "options": {
        "cwd": "packages/helm",
        "command": "helm template stereo-spot . -f values.yaml -f values-from-terraform.yaml | kubectl apply --dry-run=client -f -"
      },
      "cache": true,
      "inputs": ["default", "{workspaceRoot}/packages/aws-infra/**/*.tf"],
      "outputs": []
    }
  }
}
