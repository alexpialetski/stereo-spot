{% extends "base.html" %}
{% block title %}All videos â€” Stereo-Spot{% endblock %}
{% block content %}
<h1>All videos</h1>
{% if removed %}
<p role="status">Job removed. Cleanup in progress.</p>
{% endif %}

{% if in_progress_jobs %}
<h2>In progress</h2>
<figure>
  <table role="grid">
    <thead>
      <tr>
        <th>Title</th>
        <th>Mode</th>
        <th>Status</th>
        <th>Created</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for job in in_progress_jobs %}
      <tr>
        <td>{{ job.title or job.job_id }}</td>
        <td>{{ job.mode.value }}</td>
        <td>{{ job.status.value }}</td>
        <td data-timestamp="{{ job.created_at }}">{{ job.created_at }}</td>
        <td><a href="/jobs/{{ job.job_id }}">View</a></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</figure>
{% endif %}

{% if completed_jobs %}
<h2>Completed</h2>
<p><a href="/launch" role="button">Open all in 3D player</a></p>
<figure>
  <table role="grid">
    <thead>
      <tr>
        <th>Title</th>
        <th>Mode</th>
        <th>Completed</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for job in completed_jobs %}
      <tr>
        <td>{{ job.title or job.job_id }}</td>
        <td>{{ job.mode.value }}</td>
        <td data-timestamp="{{ job.completed_at }}">{{ job.completed_at }}</td>
        <td><a href="/jobs/{{ job.job_id }}">View</a></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</figure>
{% if next_token %}
<p><a href="/jobs?limit={{ request.query_params.get('limit', 20) }}&next_token={{ next_token }}">Next page</a></p>
{% endif %}
{% endif %}

{% if not in_progress_jobs and not completed_jobs %}
<p>No jobs yet. <a href="/">Create one</a>.</p>
{% endif %}

<script>
(function () {
  var formatter = new Intl.DateTimeFormat(undefined, {
    dateStyle: 'medium',
    timeStyle: 'short'
  });
  document.querySelectorAll('[data-timestamp]').forEach(function (el) {
    var ts = parseInt(el.getAttribute('data-timestamp'), 10);
    if (!isNaN(ts)) {
      el.textContent = formatter.format(new Date(ts * 1000));
    }
  });
})();
</script>
{% endblock %}
